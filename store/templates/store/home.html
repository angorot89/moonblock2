{% extends 'store/base.html' %}
{% load static moonblock_tags %}

{% block title %}MOONBLOCK — {% site_t site 'hero_title_line1' lang %} {% site_t site 'hero_title_line3' lang %}{% endblock %}

{% block extra_css %}
<style>
/* Hero */
.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-end;padding:0 48px 80px;position:relative;overflow:hidden;}
.hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse 80% 70% at 65% 40%,#1e1c2e 0%,var(--black) 70%);}
.moon-orb{position:absolute;right:8%;top:50%;transform:translateY(-50%);width:420px;height:420px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#e8d9c0,#b8a888 40%,#7a6a55 80%,#3a2e22);box-shadow:0 0 80px 20px rgba(200,185,154,0.15),inset -30px -20px 60px rgba(0,0,0,0.5);animation:moonFloat 8s ease-in-out infinite;}
.moon-orb::after{content:'';position:absolute;inset:0;border-radius:50%;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='420' height='420'%3E%3Ccircle cx='140' cy='110' r='28' fill='rgba(0,0,0,0.07)'/%3E%3Ccircle cx='280' cy='200' r='18' fill='rgba(0,0,0,0.06)'/%3E%3Ccircle cx='200' cy='300' r='22' fill='rgba(0,0,0,0.05)'/%3E%3Ccircle cx='90' cy='250' r='14' fill='rgba(0,0,0,0.06)'/%3E%3Ccircle cx='320' cy='100' r='10' fill='rgba(0,0,0,0.05)'/%3E%3C/svg%3E") center/cover;}
@keyframes moonFloat{0%,100%{transform:translateY(-50%) translateY(0);}50%{transform:translateY(-50%) translateY(-18px);}}
.stars{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
.star{position:absolute;background:var(--white);border-radius:50%;animation:twinkle var(--d,3s) ease-in-out infinite;opacity:0;}
@keyframes twinkle{0%,100%{opacity:0;}50%{opacity:var(--o,0.7);}}
.hero-eyebrow{font-size:11px;letter-spacing:0.3em;text-transform:uppercase;color:var(--moon);margin-bottom:20px;position:relative;z-index:2;animation:fadeUp 1s ease both;}
.hero-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(80px,12vw,160px);line-height:0.88;letter-spacing:0.02em;position:relative;z-index:2;animation:fadeUp 1s 0.1s ease both;}
.hero-title .outline{-webkit-text-stroke:1px var(--white);color:transparent;}
.hero-sub{margin-top:32px;font-size:12px;letter-spacing:0.15em;color:var(--muted);max-width:340px;line-height:1.8;position:relative;z-index:2;animation:fadeUp 1s 0.2s ease both;}
.hero-actions{margin-top:48px;display:flex;gap:16px;align-items:center;position:relative;z-index:2;animation:fadeUp 1s 0.3s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}

/* Products */
section{padding:100px 48px;}
.products{background:var(--black);}
.section-header{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:60px;}
.view-all{font-size:11px;letter-spacing:0.2em;text-transform:uppercase;color:var(--moon);text-decoration:none;opacity:0.8;transition:opacity 0.3s;display:flex;align-items:center;gap:8px;flex-shrink:0;margin-bottom:4px;}
.view-all:hover{opacity:1;} .view-all::after{content:'→';}
.product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;}
.product-card{position:relative;background:var(--dim);overflow:hidden;cursor:none;}
.product-card:first-child{grid-row:span 2;}
.product-visual{width:100%;aspect-ratio:3/4;display:flex;align-items:center;justify-content:center;transition:transform 0.6s ease;position:relative;overflow:hidden;}
.product-card:first-child .product-visual{aspect-ratio:unset;height:100%;min-height:500px;}
.product-card:hover .product-visual{transform:scale(1.04);}
.product-img-wrap{overflow:hidden;width:100%;aspect-ratio:3/4;position:relative;}
.product-card:first-child .product-img-wrap{aspect-ratio:unset;height:100%;min-height:500px;}
.product-img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.6s ease;}
.product-card:hover .product-img{transform:scale(1.04);}
.product-overlay{position:absolute;bottom:0;left:0;right:0;padding:24px;background:linear-gradient(to top,rgba(6,6,8,0.95) 0%,transparent 100%);transform:translateY(8px);transition:transform 0.3s;}
.product-card:hover .product-overlay{transform:translateY(0);}
.product-name{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;letter-spacing:0.03em;margin-bottom:4px;}
.product-price{font-size:12px;color:var(--moon);letter-spacing:0.1em;}
.product-tag{position:absolute;top:16px;left:16px;background:var(--moon);color:var(--black);font-size:9px;letter-spacing:0.15em;text-transform:uppercase;padding:4px 10px;}

/* About strip */
.about-strip{background:var(--dim);display:grid;grid-template-columns:1fr 1fr;gap:0;min-height:600px;padding:0;}
.about-text{padding:100px 80px 100px 48px;display:flex;flex-direction:column;justify-content:center;}
.about-visual{position:relative;overflow:hidden;background:#0e0d14;display:flex;align-items:center;justify-content:center;}
.about-visual-inner{width:100%;height:100%;min-height:500px;display:flex;align-items:center;justify-content:center;position:relative;}
.moon-geo{width:280px;height:280px;border-radius:50%;border:1px solid rgba(200,185,154,0.3);position:relative;display:flex;align-items:center;justify-content:center;}
.moon-geo::before{content:'';position:absolute;inset:20px;border-radius:50%;border:1px solid rgba(200,185,154,0.2);}
.moon-geo::after{content:'';position:absolute;inset:50px;border-radius:50%;background:radial-gradient(circle,rgba(200,185,154,0.15),transparent);border:1px solid rgba(200,185,154,0.15);}
.moon-text-geo{font-family:'Bebas Neue',sans-serif;font-size:48px;letter-spacing:0.1em;color:var(--moon);opacity:0.6;position:relative;z-index:1;}
.about-body{font-size:13px;line-height:2;color:var(--muted);max-width:460px;margin-bottom:24px;}
.stats{display:flex;gap:48px;margin-top:48px;padding-top:48px;border-top:1px solid rgba(200,185,154,0.15);}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:48px;color:var(--moon);letter-spacing:0.05em;}
.stat-label{font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted);margin-top:4px;}

/* Categories */
.categories{background:var(--black);}
.cat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:2px;margin-top:60px;}
.cat-item{position:relative;aspect-ratio:2/3;overflow:hidden;cursor:none;text-decoration:none;display:block;}
.cat-bg{position:absolute;inset:0;transition:transform 0.6s;}
.cat-item:hover .cat-bg{transform:scale(1.06);}
.cat-1 .cat-bg{background:linear-gradient(135deg,#1a1520 0%,#2d1f35 100%);}
.cat-2 .cat-bg{background:linear-gradient(135deg,#0f1a18 0%,#1a3028 100%);}
.cat-3 .cat-bg{background:linear-gradient(135deg,#1c1008 0%,#332010 100%);}
.cat-4 .cat-bg{background:linear-gradient(135deg,#101525 0%,#1a2545 100%);}
.cat-5 .cat-bg{background:linear-gradient(135deg,#1a1015 0%,#35202d 100%);}
.cat-6 .cat-bg{background:linear-gradient(135deg,#0f1818 0%,#1a3028 100%);}
.cat-label{position:absolute;bottom:0;left:0;right:0;padding:32px 24px 24px;background:linear-gradient(to top,rgba(6,6,8,0.9),transparent);}
.cat-name{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;letter-spacing:0.03em;margin-bottom:6px;color:var(--white);}
.cat-count{font-size:11px;color:var(--moon);letter-spacing:0.15em;}
.cat-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);opacity:0.12;}

{% if is_rtl %}
.about-strip{direction:rtl;}
.about-text{padding:100px 48px 100px 80px;}
.product-tag{left:auto;right:16px;}
.hero{padding:0 48px 80px;}
.hero-title{text-align:right;}
.hero-sub{text-align:right;}
.hero-actions{flex-direction:row-reverse;}
.section-header{flex-direction:row-reverse;}
.view-all::after{content:'←';}
{% endif %}

@media(max-width:900px){
  .hero{padding:0 24px 60px;}.moon-orb{width:260px;height:260px;right:-5%;}
  section{padding:60px 24px;}
  .product-grid{grid-template-columns:1fr 1fr;}.product-card:first-child{grid-column:span 2;grid-row:span 1;}
  .about-strip{grid-template-columns:1fr;}.about-visual{min-height:300px;}
  .cat-grid{grid-template-columns:1fr 1fr;}
}
@media(max-width:600px){
  .hero{padding:88px 16px 42px;min-height:88vh;}
  .hero-title{font-size:clamp(56px,18vw,84px);}
  .hero-sub{max-width:100%;font-size:11px;letter-spacing:.08em;margin-top:18px;}
  .hero-actions{margin-top:24px;flex-direction:column;align-items:stretch;gap:10px;}
  .moon-orb{width:190px;height:190px;right:-18%;top:26%;}
  section{padding:44px 16px;}
  .section-header{flex-direction:column;align-items:flex-start;gap:12px;margin-bottom:28px;}
  .product-grid{grid-template-columns:1fr;}
  .product-card:first-child{grid-column:span 1;}
  .product-card:first-child .product-visual,.product-card:first-child .product-img-wrap{min-height:360px;}
  .about-text{padding:54px 16px;}
  .stats{flex-direction:column;gap:20px;margin-top:26px;padding-top:26px;}
  .cat-grid{grid-template-columns:1fr;}
  .cat-item{aspect-ratio:16/10;}
}
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="hero" {% if is_rtl %}dir="rtl"{% endif %}>
  <div class="hero-bg"></div>
  <div class="stars" id="stars"></div>
  <div class="moon-orb"></div>
  <p class="hero-eyebrow">{% site_t site 'hero_eyebrow' lang %}</p>
  <h1 class="hero-title">
    {% site_t site 'hero_title_line1' lang %}<br>
    <span class="outline">{% site_t site 'hero_title_line2' lang %}</span><br>
    {% site_t site 'hero_title_line3' lang %}
  </h1>
  <p class="hero-sub">{% site_t site 'hero_subtitle' lang %}</p>
  <div class="hero-actions">
    <a href="{% url 'shop' %}" class="btn-primary">{% site_t site 'hero_cta' lang %}</a>
    <a href="{% url 'lookbook' %}" class="btn-ghost">{% site_t site 'hero_cta2' lang %}</a>
  </div>
</section>

{% block ticker %}
<div class="ticker">
  <div class="ticker-inner">
    {% site_t site 'ticker_items' lang as ticker_raw %}
    {% with items=ticker_raw|split:',' %}
    {% for item in items %}<span class="ticker-item">{{ item }}</span><span class="ticker-dot">✦</span>{% endfor %}
    {% for item in items %}<span class="ticker-item">{{ item }}</span><span class="ticker-dot">✦</span>{% endfor %}
    {% endwith %}
  </div>
</div>
{% endblock %}

<!-- Products / New Arrivals -->
<section class="products">
  <div class="section-header reveal" {% if is_rtl %}dir="rtl"{% endif %}>
    <div>
      <p class="section-label">{% site_t site 'new_arrivals_label' lang %}</p>
      <h2 class="section-title">
        {% site_t site 'new_arrivals_title' lang as ntitle %}
        {% for line in ntitle|split:'\n' %}{{ line }}<br>{% endfor %}
      </h2>
    </div>
    <a href="{% url 'shop' %}" class="view-all">{% if lang == 'ar' %}عرض الكل{% elif lang == 'fr' %}Tout voir{% else %}View All{% endif %}</a>
  </div>

  {% if new_arrivals %}
  <div class="product-grid reveal">
    {% for product in new_arrivals %}
    <div class="product-card">
      {% if product.is_new %}<span class="product-tag">{% if lang == 'ar' %}جديد{% elif lang == 'fr' %}NOUVEAU{% else %}NEW{% endif %}</span>{% endif %}
      <a href="{% url 'product_detail' product.slug %}" style="text-decoration:none;display:block;{% if forloop.first %}height:100%;{% endif %}">
        {% if product.image %}
        <div class="product-img-wrap">
          <img src="{{ product.image.url }}" alt="{{ product.name_en }}" class="product-img">
        </div>
        {% else %}
        <div class="product-visual" style="background:linear-gradient(160deg,#1a1520,#0e0d14);">
          <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" style="width:60%;max-width:160px;opacity:.5;">
            <rect x="20" y="10" width="80" height="100" rx="4" stroke="#C8B99A" stroke-width="1.5"/>
            <line x1="20" y1="35" x2="100" y2="35" stroke="#C8B99A" stroke-width="0.8"/>
            <circle cx="60" cy="22" r="5" stroke="#C8B99A" stroke-width="1"/>
            <text x="60" y="75" text-anchor="middle" fill="#C8B99A" font-size="9" font-family="monospace" letter-spacing="2">MB</text>
          </svg>
        </div>
        {% endif %}
        <div class="product-overlay">
          <p class="product-name">{{ product.name|t:lang }}</p>
          <p class="product-price">{{ product.price }} MAD</p>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="reveal" style="text-align:center;padding:80px;color:var(--muted);">
    <p style="font-size:13px;letter-spacing:.1em;">{% if lang == 'ar' %}المنتجات قادمة قريباً{% elif lang == 'fr' %}Produits bientôt disponibles{% else %}Products coming soon{% endif %}. <a href="/admin/store/product/add/" style="color:var(--moon);">{% if lang == 'ar' %}أضف منتجات{% elif lang == 'fr' %}Ajouter des produits{% else %}Add products{% endif %} →</a></p>
  </div>
  {% endif %}
</section>

<!-- About -->
<div class="about-strip" id="about" {% if is_rtl %}dir="rtl"{% endif %}>
  <div class="about-text reveal">
    <p class="section-label">{% site_t site 'about_label' lang %}</p>
    <h2 style="font-family:'Bebas Neue';font-size:clamp(40px,5vw,64px);letter-spacing:.02em;line-height:1;margin-bottom:32px;">
      {% site_t site 'about_title' lang as atitle %}
      {% for line in atitle|split:'\n' %}{{ line }}<br>{% endfor %}
    </h2>
    <p class="about-body">{% site_t site 'about_body1' lang %}</p>
    <p class="about-body">{% site_t site 'about_body2' lang %}</p>
    <a href="{% url 'shop' %}" class="btn-primary" style="align-self:flex-start;">{% site_t site 'about_cta' lang %}</a>
    <div class="stats">
      <div>
        <p class="stat-val">{{ site.stat1_value }}</p>
        <p class="stat-label">{% site_t site 'stat1_label' lang %}</p>
      </div>
      <div>
        <p class="stat-val">{{ site.stat2_value }}</p>
        <p class="stat-label">{% site_t site 'stat2_label' lang %}</p>
      </div>
      <div>
        <p class="stat-val">{{ site.stat3_value }}</p>
        <p class="stat-label">{% site_t site 'stat3_label' lang %}</p>
      </div>
    </div>
  </div>
  <div class="about-visual">
    <div class="about-visual-inner">
      <div class="moon-geo">
        <span class="moon-text-geo">MB</span>
      </div>
    </div>
  </div>
</div>

<!-- Categories -->
{% if categories %}
<section class="categories">
  <div class="reveal" {% if is_rtl %}dir="rtl"{% endif %}>
    <p class="section-label">{% site_t site 'categories_label' lang %}</p>
    <h2 class="section-title">{% site_t site 'categories_title' lang %}</h2>
  </div>
  <div class="cat-grid reveal">
    {% for cat in categories %}
    <a href="{% url 'shop' %}?category={{ cat.slug }}" class="cat-item cat-{{ forloop.counter }}">
      <div class="cat-bg"></div>
      <div class="cat-icon">
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="60" cy="60" r="40" stroke="#C8B99A" stroke-width="2"/>
          <circle cx="60" cy="60" r="20" stroke="#C8B99A" stroke-width="1.5"/>
        </svg>
      </div>
      <div class="cat-label">
        <p class="cat-name">{{ cat.name|t:lang }}</p>
        <p class="cat-count">{{ cat.products.count }} {% if lang == 'ar' %}منتج{% elif lang == 'fr' %}Articles{% else %}Items{% endif %}</p>
      </div>
    </a>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
const starsEl=document.getElementById('stars');
for(let i=0;i<80;i++){
  const s=document.createElement('div');s.className='star';
  const size=Math.random()*2+.5;
  s.style.cssText=`width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${2+Math.random()*4}s;--o:${.3+Math.random()*.7};animation-delay:${Math.random()*5}s;`;
  starsEl.appendChild(s);
}
</script>
{% endblock %}
